# TDX Macro Manager UI

Интерфейс управления макросами для Tower Defense на базе [Starlight Interface Suite](https://docs.nebulasoftworks.xyz/starlight).

## Описание

Скрипт `macro_ui.lua` предоставляет удобный графический интерфейс для:
- **Записи макросов** - автоматическая запись всех действий игрока
- **Воспроизведения макросов** - выбор и запуск сохраненных макросов

## Требования

1. **Starlight Interface Suite** - должен находиться в папке `ui/Source.lua`
2. **record.lua** - скрипт для записи макросов (в корне проекта)
3. **run_macro.lua** - скрипт для воспроизведения макросов (в корне проекта)
4. Executor с поддержкой:
   - `readfile`, `writefile`, `isfile`, `listfiles`
   - `getgenv()` или `getfenv()`

## Установка

1. Убедитесь, что файл `ui/Source.lua` содержит Starlight библиотеку
2. Убедитесь, что файлы `record.lua` и `run_macro.lua` находятся в корне проекта
3. Запустите скрипт `macro_ui.lua` через executor

## Использование

### Запись макроса

1. Нажмите кнопку **"Start Recording"**
2. Играйте как обычно - все ваши действия автоматически записываются
3. Нажмите **"Stop Recording"** для остановки записи
4. Макрос сохранится в `tdx/macros/recorder_output.json`

### Воспроизведение макроса

1. Выберите макрос из dropdown **"Select Macro"**
2. Нажмите кнопку **"Play Selected Macro"**
3. Макрос начнет автоматически воспроизводиться

### Обновление списка макросов

- Нажмите кнопку **"Refresh Macro List"** для ручного обновления
- Список автоматически обновляется каждые 5 секунд
- Список также обновляется после остановки записи

## Структура файлов

```
tdx/
├── ui/
│   └── Source.lua          # Starlight Interface Suite
├── macros/
│   ├── recorder_output.json # Записанный макрос
│   ├── macro1.json         # Другие макросы
│   └── macro2.json
├── record.lua              # Скрипт записи
├── run_macro.lua           # Скрипт воспроизведения
└── macro_ui.lua            # UI скрипт (этот файл)
```

## Функции интерфейса

### Record Macro (Группбокс записи)
- **Start/Stop Recording** - переключаемая кнопка для начала/остановки записи
- Показывает уведомления о статусе записи

### Play Macro (Группбокс воспроизведения)
- **Select Macro** - dropdown для выбора макроса из списка
- **Play Selected Macro** - кнопка для запуска выбранного макроса
- **Refresh Macro List** - кнопка для обновления списка макросов

### Information (Группбокс информации)
- Информация о том, как использовать функции записи и воспроизведения
- Путь к файлам макросов

## Особенности

- ✅ Автоматическое обновление списка макросов
- ✅ Сохранение выбранного макроса при обновлении
- ✅ Уведомления о статусе операций
- ✅ Обработка ошибок с понятными сообщениями
- ✅ Интеграция с существующими скриптами `record.lua` и `run_macro.lua`

## Устранение проблем

### Ошибка "Файл ui/Source.lua не найден"
- Убедитесь, что Starlight находится в папке `ui/Source.lua`
- Проверьте правильность пути к файлу

### Ошибка "Файл record.lua не найден"
- Убедитесь, что `record.lua` находится в корне проекта
- Проверьте права доступа к файлу

### Макросы не отображаются в списке
- Проверьте, что файлы находятся в `tdx/macros/`
- Убедитесь, что файлы имеют расширение `.json`
- Нажмите "Refresh Macro List" для обновления

### Запись не работает
- Убедитесь, что игра загружена
- Проверьте, что executor поддерживает необходимые функции
- Проверьте консоль на наличие ошибок

## Примечания

- Макросы сохраняются в формате JSON
- Имя файла макроса = имя без расширения `.json`
- При записи старый файл `recorder_output.json` удаляется
- Воспроизведение макроса можно запустить только когда запись не активна

## Дополнительная информация

Документация Starlight: https://docs.nebulasoftworks.xyz/starlight

